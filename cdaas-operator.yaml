---
version: v1
kind: kubernetes
application: armory-spinnaker-operator
targets:
  crd1:
    account: local-cluster
    namespace: spinnaker-operator
    strategy: simple
  crd2:
    account: local-cluster
    namespace: spinnaker-operator
    strategy: simple
    constraints:
      dependsOn:
      - crd1
      afterDeployment:
      - pause: 
          duration: 1
          unit: seconds      
  operator:
    account: local-cluster
    namespace: spinnaker-operator
    strategy: simple
    constraints:
      dependsOn:
      - crd2
      afterDeployment:
      - pause: 
          duration: 1
          unit: seconds 
  spinnaker:
    account: local-cluster
    namespace: spinnaker
    strategy: simple
    constraints:
      dependsOn:
      - operator
manifests:
  - path: cluster/armory-enterprise-operator/crds/spinnaker.armory.io_spinnakerservices.yaml
    targets: ['crd1']
  - path: cluster/armory-enterprise-operator/crds/spinnaker.armory.io_armoryaccounts.yaml
    targets: ['crd2']
  - path: cluster/armory-enterprise-operator/operator/cluster/
    targets: ['operator']
  - path: cluster/spinnaker/minio-s3-for-kayenta.yaml
    targets: ['spinnaker']
  - path: cluster/spinnaker/mysql.yaml
    targets: ['spinnaker']
  - path: cluster/spinnaker/permissions.yaml
    targets: ['spinnaker']
  - path: cluster/spinnaker/spinnaker.yaml
    targets: ['spinnaker']
strategies:
  simple:
    canary:
      steps:
        - setWeight:
            weight: 100           
