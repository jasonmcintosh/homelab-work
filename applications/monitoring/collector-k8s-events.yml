mode: deployment

image:
  #repository: ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-k8s
  repository: ghcr.io/open-telemetry/opentelemetry-collector-releases/opentelemetry-collector-contrib

#extraEnvs:
#  - name: HONEYCOMB_API_KEY
#    valueFrom:
#      secretKeyRef:
#        name: honeycomb
#        key: api-key

# We only want one of these collectors - any more and we'd produce duplicate data
replicaCount: 1

presets:
  # enables the k8sclusterreceiver and adds it to the metrics pipelines
  clusterMetrics:
    enabled: true
  # enables the k8sobjectsreceiver to collect events only and adds it to the logs pipelines
  kubernetesEvents:
    enabled: true

config:
  receivers:
    k8s_cluster:
      collection_interval: 30s
      metrics:
        # Disable replicaset metrics by default. These are typically high volume, low signal metrics.
        # If volume is not a concern, then the following blocks can be removed.
        k8s.replicaset.desired:
          enabled: false
        k8s.replicaset.available:
          enabled: false 
  exporters:
    clickhouse:
      endpoint: tcp://192.168.19.204:9000?dial_timeout=10s&compress=lz4
      username: clickhouse
      password: changeme
      database: otel
      async_insert: true
      create_schema: true

  service:
    pipelines:
      metrics:
        exporters: [ clickhouse ]
        #exporters: [ otlp/k8s-metrics ]
      logs:
        exporters: [clickhouse]
